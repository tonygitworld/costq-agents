# Agent ä»£ç é‡æ„éœ€æ±‚åˆ†æ

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®èƒŒæ™¯](#1-é¡¹ç›®èƒŒæ™¯)
- [2. å½“å‰æ¶æ„åˆ†æ](#2-å½“å‰æ¶æ„åˆ†æ)
- [3. æ–°æ¶æ„è®¾è®¡](#3-æ–°æ¶æ„è®¾è®¡)
- [4. Agent ä»£ç æ¸…å•](#4-agent-ä»£ç æ¸…å•)
- [5. è°ƒç”¨é“¾è·¯åˆ†æ](#5-è°ƒç”¨é“¾è·¯åˆ†æ)
- [6. ä¾èµ–å…³ç³»åˆ†æ](#6-ä¾èµ–å…³ç³»åˆ†æ)
- [7. è¿ç§»è®¡åˆ’](#7-è¿ç§»è®¡åˆ’)
- [8. é£é™©è¯„ä¼°](#8-é£é™©è¯„ä¼°)

---

## 1. é¡¹ç›®èƒŒæ™¯

### 1.1 ç°çŠ¶

å½“å‰ `strands-agent-demo` ä»“åº“æ˜¯ä¸€ä¸ª**å•ä½“ä»“åº“ï¼ˆMonorepoï¼‰**ï¼ŒåŒ…å«ï¼š

- **Frontend** - React + TypeScript å‰ç«¯åº”ç”¨
- **Backend** - FastAPI åç«¯æœåŠ¡
- **Agent** - Agent ä»£ç ï¼ˆç›®å‰ä¸ Backend æ··åœ¨ä¸€èµ·ï¼‰
- **MCP Servers** - å¤šä¸ª MCP Server å®ç°ï¼ˆéƒ¨åˆ†å·²æ‹†åˆ†ï¼Œéƒ¨åˆ†ä»åœ¨ä»“åº“å†…ï¼‰
- **Deployment** - éƒ¨ç½²è„šæœ¬å’Œé…ç½®

**âš ï¸ å½“å‰é—®é¢˜**ï¼š
- Agent ä»£ç ä½äº `backend/agent/`ï¼Œä¸ FastAPI Backend ä»£ç æ··åœ¨ä¸€èµ·
- è™½ç„¶éƒ¨ç½²å·²ç‹¬ç«‹ï¼ˆFrontend + Backend åœ¨ EKSï¼ŒAgent åœ¨ AgentCore Runtimeï¼‰ï¼Œä½†ä»£ç ä»“åº“ä»ç„¶è€¦åˆ
- æ— æ³•ç‹¬ç«‹ç®¡ç† Agent çš„ç‰ˆæœ¬å’Œå‘å¸ƒï¼Œä»£ç å˜æ›´ä¼šç›¸äº’å½±å“

### 1.2 å·²å®Œæˆçš„å·¥ä½œ

éƒ¨åˆ† MCP Server å·²æ‹†åˆ†åˆ°ç‹¬ç«‹ä»“åº“å¹¶é€šè¿‡ **AgentCore Gateway** ç‹¬ç«‹éƒ¨ç½²ï¼š

- âœ… `billing-cost-management` - æˆæœ¬ä¼˜åŒ–å’Œç®¡ç†
- âœ… `risp` - RI/SP åˆ†æ
- âœ… `cloudtrail` - CloudTrail æ—¥å¿—æŸ¥è¯¢

è¿™äº› MCP Server å·²ç»å®ç°ï¼š
- ç‹¬ç«‹çš„ Git ä»“åº“
- ç‹¬ç«‹çš„ CI/CD æµç¨‹
- é€šè¿‡ AgentCore Gateway æä¾›æœåŠ¡ï¼ˆHTTP + SigV4 è®¤è¯ï¼‰

**å½“å‰å•ä½“ä»“åº“ä¿ç•™çš„ MCP Server**ï¼ˆæœ¬åœ° stdio æ¨¡å¼ï¼‰ï¼š
- `common-tools` - é€šç”¨å·¥å…·é›†
- `pricing` - AWS Pricing API
- `documentation` - AWS Documentation
- `alert` - å‘Šè­¦ç®¡ç†
- `send-email` - é‚®ä»¶å‘é€
- `gcp-cost` - GCP æˆæœ¬åˆ†æ

### 1.3 é‡æ„ç›®æ ‡

å°† **Agent ä»£ç ** ä»å½“å‰å•ä½“ä»“åº“ä¸­å‰¥ç¦»ï¼Œåˆ›å»ºç‹¬ç«‹çš„ Agent ä»“åº“ï¼Œå®ç°ï¼š

1. **ä»£ç è§£è€¦** - Agent ä¸ Backend åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°
2. **ç‹¬ç«‹éƒ¨ç½²** - Agent å¯ç‹¬ç«‹éƒ¨ç½²åˆ° AgentCore Runtime
3. **ç®€åŒ–ç»´æŠ¤** - å‡å°‘ä»£ç å†—ä½™ï¼Œä¾¿äºåç»­è¿­ä»£
4. **æ¶æ„ç»Ÿä¸€** - ä¸å·²æ‹†åˆ†çš„ MCP Server ä¿æŒä¸€è‡´

**æ‰§è¡Œç­–ç•¥**ï¼šå¯¹åŸ monorepo ä»“åº“ä¸åšä»£ç ä¿®æ”¹ï¼Œä»…é€æ­¥å°†æ¨¡å—è¿å‡ºåˆ°æ–°ä»“åº“ï¼Œå¾…æ–°ä»“åº“ç¨³å®šåå†æ•´ä½“åºŸå¼ƒæ—§å®ç°ã€‚æœ¬æ¬¡ä»…æ›´æ–°æ–‡æ¡£ä¸è¿ç§»è§„åˆ’ã€‚

---

## 2. å½“å‰æ¶æ„åˆ†æ

### 2.1 å•ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Monorepo: strands-agent-demo                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Frontend   â”‚â”€â”€â”€â”€â”€>â”‚   Backend (FastAPI)      â”‚       â”‚
â”‚  â”‚  (React/TS)  â”‚      â”‚                          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  âš ï¸ æ··åœ¨ä¸€èµ· âš ï¸          â”‚       â”‚
â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚                        â”‚  â”‚  Agent ä»£ç  (è€¦åˆ) â”‚  â”‚       â”‚
â”‚                        â”‚  â”‚  - agent_runtime   â”‚  â”‚       â”‚
â”‚                        â”‚  â”‚  - agent_manager   â”‚  â”‚       â”‚
â”‚                        â”‚  â”‚  - prompts/        â”‚  â”‚       â”‚
â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚                        â”‚                          â”‚       â”‚
â”‚                        â”‚  - API è·¯ç”±             â”‚       â”‚
â”‚                        â”‚  - æ•°æ®åº“æ¨¡å‹           â”‚       â”‚
â”‚                        â”‚  - MCP Client ç®¡ç†      â”‚       â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚        æœ¬åœ° MCP Servers (stdio)              â”‚        â”‚
â”‚  â”‚  - common-tools      (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â”‚  - pricing           (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â”‚  - documentation     (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â”‚  - alert             (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â”‚  - send-email        (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â”‚  - gcp-cost          (ä»åœ¨ä»“åº“)              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (å·²æ‹†åˆ†åˆ° Gateway MCP)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AgentCore Gateway (è¿œç¨‹éƒ¨ç½²)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - billing-cost-management  (âœ… å·²ç‹¬ç«‹ä»“åº“)                 â”‚
â”‚  - risp                     (âœ… å·²ç‹¬ç«‹ä»“åº“)                 â”‚
â”‚  - cloudtrail               (âœ… å·²ç‹¬ç«‹ä»“åº“)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å½“å‰é—®é¢˜

#### é—®é¢˜ 1: ä»£ç è€¦åˆä¸¥é‡

- âŒ Agent ä»£ç ä¸ FastAPI Backend æ··åœ¨ `backend/` ç›®å½•ä¸‹
- âŒ éš¾ä»¥ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½² Agent
- âŒ Backend ä»£ç åº“è¿‡äºåºå¤§ï¼ˆåŒ…å« Agentã€MCPã€APIã€æ•°æ®åº“ç­‰ï¼‰
- âŒ èŒè´£ä¸æ¸…æ™°ï¼šBackend æ—¢æä¾› APIï¼ŒåˆåŒ…å« Agent å®ç°

#### é—®é¢˜ 2: ä»£ç ç®¡ç†æ··ä¹±

- âŒ Agent ä»£ç ä¸ Backend ä»£ç æ··åœ¨åŒä¸€ä¸ªä»“åº“
- âŒ è™½ç„¶ Agent å·²ç‹¬ç«‹éƒ¨ç½²åˆ° AgentCore Runtimeï¼Œä½†ä»£ç ä»“åº“ä»ç„¶è€¦åˆ
- âŒ Agent ä»£ç å˜æ›´ä¼šå‡ºç°åœ¨ Backend çš„ä»£ç å®¡æŸ¥ä¸­
- âŒ æ— æ³•ç‹¬ç«‹ç®¡ç† Agent çš„ç‰ˆæœ¬å’Œå‘å¸ƒèŠ‚å¥
- âŒ éš¾ä»¥è¿½è¸ª Agent çš„ç‹¬ç«‹å˜æ›´å†å²

#### é—®é¢˜ 3: æ¶æ„ä¸ä¸€è‡´

- âŒ éƒ¨åˆ† MCP Server å·²æ‹†åˆ†ï¼ˆGateway éƒ¨ç½²ï¼‰ï¼Œéƒ¨åˆ†ä»åœ¨å•ä½“ä»“åº“ï¼ˆstdio æ¨¡å¼ï¼‰
- âŒ Agent ä»åœ¨å•ä½“ä»“åº“ï¼Œä¸å·²æ‹†åˆ†çš„ MCP Server æ¶æ„ä¸ä¸€è‡´
- âŒ éš¾ä»¥ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤

#### é—®é¢˜ 4: ç»´æŠ¤å›°éš¾

- âŒ Agent ä»£ç å˜æ›´ä¼šå½±å“ Backend ä»£ç å®¡æŸ¥
- âŒ éš¾ä»¥åŒºåˆ†å“ªäº›æ˜¯ Agent æ ¸å¿ƒé€»è¾‘ï¼Œå“ªäº›æ˜¯ Backend ä¸šåŠ¡é€»è¾‘
- âŒ MCP Server ç®¡ç†åˆ†æ•£ï¼ˆéƒ¨åˆ†æœ¬åœ°ã€éƒ¨åˆ† Gatewayï¼‰
- âŒ æ— æ³•ç‹¬ç«‹ç®¡ç† Agent çš„ç‰ˆæœ¬å’Œå‘å¸ƒ

---

## 3. æ–°æ¶æ„è®¾è®¡

### 3.1 ç›®æ ‡æ¶æ„å›¾

![æ–°æ¶æ„å›¾](image.jpg)

**æ¶æ„è¯´æ˜**ï¼š

```
Internet
   â”‚
   â”œâ”€> CloudFront + Route 53
   â”‚         â”‚
   â”‚         â””â”€> ELB (Public)
   â”‚               â”‚
   â”‚               â”œâ”€> Frontend (Static Files on Nginx)
   â”‚               â”‚
   â”‚               â””â”€> Backend (FastAPI in EKS)
   â”‚                     â”‚
   â”‚                     â”œâ”€> Database (RDS PostgreSQL)
   â”‚                     â”‚
   â”‚                     â””â”€> AgentCore Runtime (Private Subnet)
   â”‚                           â”‚
   â”‚                           â””â”€> Agent (ç‹¬ç«‹ä»“åº“ï¼Œç‹¬ç«‹éƒ¨ç½²)
   â”‚                                 â”‚
   â”‚                                 â””â”€> AgentCore Gateway
   â”‚                                       â”‚
   â”‚                                       â””â”€> MCP Servers
   â”‚                                             - billing-cost-management
   â”‚                                             - risp
   â”‚                                             - common-tools
   â”‚                                             - pricing
   â”‚                                             - documentation
   â”‚                                             - alert
   â”‚                                             - send-email
   â”‚                                             - gcp-cost
```

### 3.2 æ ¸å¿ƒå˜åŒ–

#### å˜åŒ– 1: Agent ç‹¬ç«‹éƒ¨ç½²

| ç»´åº¦ | æ—§æ¶æ„ | æ–°æ¶æ„ |
|------|--------|--------|
| **ä»£ç ä½ç½®** | `backend/agent/`ï¼ˆå•ä½“ä»“åº“ï¼‰ | ç‹¬ç«‹ Git ä»“åº“ `costq-agents` |
| **éƒ¨ç½²æ–¹å¼** | å·²ç‹¬ç«‹éƒ¨ç½²åˆ° AgentCore Runtime | ä¿æŒç‹¬ç«‹éƒ¨ç½²ï¼ˆä¸å˜ï¼‰ |
| **ä»£ç ç®¡ç†** | ä¸ Backend æ··åœ¨ä¸€èµ· | ç‹¬ç«‹ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ |
| **ä»£ç å®¡æŸ¥** | ä¸ Backend ä¸€èµ·å®¡æŸ¥ | Agent ç‹¬ç«‹å®¡æŸ¥ |
| **å‘å¸ƒèŠ‚å¥** | å— Backend å½±å“ | Agent å¯ç‹¬ç«‹å‘å¸ƒ |

#### å˜åŒ– 2: MCP ç»Ÿä¸€ç®¡ç†

| ç±»å‹ | è¿æ¥æ–¹å¼ | è®¤è¯æ–¹å¼ | ç¤ºä¾‹ |
|------|----------|----------|------|
| **æœ¬åœ° MCP** | stdio (å­è¿›ç¨‹) | ç¯å¢ƒå˜é‡ä¼ é€’å‡­è¯ | `common-tools`, `pricing`, `alert`, `send-email`, `gcp-cost` |
| **Gateway MCP** | HTTP (è¿œç¨‹) | SigV4 ç­¾å | `billing-cost-management`, `risp`, `cloudtrail` |

#### å˜åŒ– 3: è°ƒç”¨æµç¨‹

**å½“å‰è°ƒç”¨æµç¨‹**ï¼ˆå·²æ˜¯ç›®æ ‡æ¶æ„ï¼‰ï¼š
```
Frontend â†’ Backend API (EKS) â†’ AgentCore Runtime â†’ Agent â†’ MCP
                                                             â”œâ”€> stdio (æœ¬åœ°)
                                                             â””â”€> Gateway (è¿œç¨‹)
```

**è¯´æ˜**ï¼š
- âœ… éƒ¨ç½²æ¶æ„å·²ç»æ˜¯ç›®æ ‡æ¶æ„ï¼ˆAgent ç‹¬ç«‹éƒ¨ç½²åœ¨ Runtimeï¼‰
- âŒ ä»£ç ä»“åº“ä»ç„¶æ˜¯å•ä½“æ¶æ„ï¼ˆAgent ä»£ç æ··åœ¨ `backend/agent/`ï¼‰
- ğŸ¯ æœ¬æ¬¡é‡æ„ï¼šä»£ç ä»“åº“æ‹†åˆ†ï¼Œä¸éƒ¨ç½²æ¶æ„å¯¹é½

---

## 4. Agent ä»£ç æ¸…å•

### 4.1 æ ¸å¿ƒä»£ç ï¼ˆå¿…é¡»è¿ç§»ï¼‰

#### 4.1.1 Agent è¿è¡Œæ—¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | ç”¨é€” | ä¾èµ– |
|---------|------|------|------|
| `backend/agent/agent_runtime.py` | âœ… **AgentCore Runtime å…¥å£** | - æ¥æ”¶ AgentCore è°ƒç”¨<br>- æŸ¥è¯¢æ•°æ®åº“è·å–è´¦å·ä¿¡æ¯<br>- AssumeRole è·å–å‡­è¯<br>- åˆ›å»º MCP å®¢æˆ·ç«¯<br>- æ‰§è¡Œ Agent å¹¶æµå¼è¿”å› | - `bedrock_agentcore`<br>- `strands`<br>- `backend.database`<br>- `backend.config.settings` |
| `backend/agent/agent_manager.py` | âœ… **Agent ç®¡ç†å™¨** | - åˆ›å»º BedrockModel å®ä¾‹<br>- åˆ›å»º Agentï¼ˆå¸¦/ä¸å¸¦ Memoryï¼‰<br>- ç®¡ç† Prompt Caching | - `strands`<br>- `bedrock_agentcore.memory`<br>- `backend.config.settings` |
| `backend/agent/streaming_agent.py` | âŒ **å·²åºŸå¼ƒ** | WebSocket æ¨¡å¼ï¼ˆå·²è¢« AgentCore Runtime æ›¿ä»£ï¼‰ | - |

#### 4.1.2 æç¤ºè¯ç³»ç»Ÿ

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | ç”¨é€” |
|---------|------|------|
| `backend/agent/prompts/__init__.py` | âœ… æç¤ºè¯å¯¼å‡º | ç»Ÿä¸€å¯¼å‡ºæç¤ºè¯æ¥å£ |
| `backend/agent/prompts/loader.py` | âœ… æç¤ºè¯åŠ è½½å™¨ | è´Ÿè´£æŒ‰ç›®å½•åŠ è½½ä¸ç¼“å­˜æç¤ºè¯ |
| `backend/agent/prompts/README.md` | âœ… æç¤ºè¯ç´¢å¼• | è¯´æ˜æç¤ºè¯ç›®å½•ç»“æ„ä¸ç”¨é€” |
| `backend/agent/prompts/aws/` | âœ… AWS å¯¹è¯æç¤ºè¯ | Agent ç³»ç»Ÿæç¤ºè¯ï¼ˆå«ç¤ºä¾‹ï¼ŒæŒ‰æ¨¡å—æ‹†åˆ†ï¼‰ |
| `backend/agent/prompts/gcp/` | âœ… GCP å¯¹è¯æç¤ºè¯ | GCP æˆæœ¬åˆ†æç›¸å…³æç¤ºè¯ |
| `backend/agent/prompts/core/` | âœ… æ ¸å¿ƒæç¤ºè¯ | é€šç”¨ç³»ç»Ÿçº¦æŸä¸è¡Œä¸ºè§„èŒƒ |
| `backend/agent/prompts/shared/` | âœ… å…±äº«æç¤ºè¯ | å¤šåœºæ™¯å…±äº«ç‰‡æ®µ |
| `backend/agent/prompts/examples/` | âœ… ç¤ºä¾‹ | Few-shot ç¤ºä¾‹ä¸æ ¼å¼æ¨¡æ¿ |
| `backend/agent/prompts/alert_agent/alert_prompts.py` | âœ… å‘Šè­¦æ‰§è¡Œæç¤ºè¯ | å‘Šè­¦åœºæ™¯æç¤ºè¯å…¥å£ |
| `backend/agent/prompts/alert_agent/alert_execution_system.md` | âœ… å‘Šè­¦æ‰§è¡Œç³»ç»Ÿæç¤ºè¯ | å‘Šè­¦åœºæ™¯ç³»ç»Ÿæç¤ºè¯æ­£æ–‡ |

#### 4.1.3 MCP ç®¡ç†

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | ç”¨é€” | ä¾èµ– |
|---------|------|------|------|
| `backend/mcp/mcp_manager.py` | âœ… **MCP å®¢æˆ·ç«¯ç®¡ç†å™¨** | - åˆ›å»ºæœ¬åœ° MCP å®¢æˆ·ç«¯ (stdio)<br>- åˆ›å»º Gateway MCP å®¢æˆ·ç«¯ (HTTP + SigV4)<br>- ç®¡ç†å·¥å…·åˆ—è¡¨è·å–<br>- å¤„ç†åˆ†é¡µ | - `mcp`<br>- `httpx`<br>- `backend.services.streamable_http_sigv4` |
| `backend/mcp/connection_pool.py` | âœ… è¿æ¥æ± ç®¡ç† | Gateway MCP è¿æ¥å¤ç”¨ | - `httpx` |

#### 4.1.4 æœ¬åœ° MCP Serversï¼ˆå¿…é¡»æ‰“åŒ…ï¼‰

| ç›®å½• | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `backend/mcp/common_tools_mcp_server/` | âœ… é€šç”¨å·¥å…· MCP | æ—¶é—´æ—¥æœŸç­‰åŸºç¡€åŠŸèƒ½ |
| `backend/mcp/alert_mcp_server/` | âœ… å‘Šè­¦ç®¡ç† MCP | å¹³å°çº§å‘Šè­¦ CRUD |
| `backend/mcp/send_email_mcp_server/` | âœ… é‚®ä»¶å‘é€ MCP | å¹³å°çº§é‚®ä»¶æœåŠ¡ |
| `backend/mcp/gcp_cost_mcp_server/` | âœ… GCP æˆæœ¬ MCP | GCP æˆæœ¬åˆ†æ |
| `backend/mcp/risp_mcp_server/` | âš ï¸ **å·²è¿ç§»åˆ° Gateway** | ä»…ä¿ç•™ä½œä¸ºæœ¬åœ°å¤‡ä»½ï¼ˆæœªä½¿ç”¨ï¼‰ï¼Œæœ¬åœ°å…¥å£åœ¨ `config/mcp_config.json` ä¸­ä»¥ `_disabled_risp-analyzer` å½¢å¼ç¦ç”¨ |

### 4.2 ä¾èµ–æ¨¡å—ï¼ˆéœ€è¦é€‰æ‹©æ€§è¿ç§»ï¼‰

#### 4.2.1 é…ç½®ç®¡ç†

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | æ˜¯å¦è¿ç§» | å¤‡æ³¨ |
|---------|------|----------|------|
| `backend/config/settings.py` | âœ… ç»Ÿä¸€é…ç½® | âœ… **å¿…é¡»** | Agent éœ€è¦è¯»å– Bedrockã€Memoryã€MCP é…ç½® |
| `backend/config/aws_secrets.py` | âœ… Secrets Manager | âœ… **å¿…é¡»** | ç”¨äºè¯»å– RDS å¯†é’¥ |

#### 4.2.2 æ•°æ®åº“è®¿é—®

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | æ˜¯å¦è¿ç§» | å¤‡æ³¨ |
|---------|------|----------|------|
| `backend/database.py` | âœ… æ•°æ®åº“è¿æ¥ | âœ… **å¿…é¡»** | Agent éœ€è¦æŸ¥è¯¢è´¦å·ä¿¡æ¯ |
| `backend/models/` | âœ… æ•°æ®åº“æ¨¡å‹ | âš ï¸ **éƒ¨åˆ†** | ä»…è¿ç§»è´¦å·ç›¸å…³æ¨¡å‹ï¼ˆAWS/GCPè´¦å·ï¼‰ |

#### 4.2.3 æœåŠ¡å±‚

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | æ˜¯å¦è¿ç§» | å¤‡æ³¨ |
|---------|------|----------|------|
| `backend/services/credential_manager.py` | âœ… å‡­è¯åŠ å¯†/è§£å¯† | âœ… **å¿…é¡»** | Agent éœ€è¦è§£å¯† AKSK |
| `backend/services/gcp_credential_manager.py` | âœ… GCP å‡­è¯ç®¡ç† | âœ… **å¿…é¡»** | Agent éœ€è¦è§£å¯† GCP Service Account |
| `backend/services/iam_role_session_factory.py` | âœ… IAM Role AssumeRole | âœ… **å¿…é¡»** | Agent éœ€è¦ AssumeRole è·å–ä¸´æ—¶å‡­è¯ |
| `backend/utils/aws_session_factory.py` | âœ… AWS Session å·¥å‚ | âœ… **å¿…é¡»** | Bedrock è·¨è´¦å·è®¿é—® |
| `backend/services/agentcore_client.py` | âŒ AgentCore è°ƒç”¨å®¢æˆ·ç«¯ | âŒ **ä¸è¿ç§»** | ä»… Backend ä½¿ç”¨ï¼Œè°ƒç”¨ Agent Runtime |
| `backend/services/chat_storage_*.py` | âŒ èŠå¤©è®°å½•å­˜å‚¨ | âŒ **ä¸è¿ç§»** | ä»… Backend ä½¿ç”¨ï¼ŒAgent ä¸ç›´æ¥æ“ä½œèŠå¤©è®°å½• |
| `backend/services/audit_logger.py` | âŒ å®¡è®¡æ—¥å¿— | âŒ **ä¸è¿ç§»** | ä»… Backend ä½¿ç”¨ |

### 4.3 å†—ä½™ä»£ç ï¼ˆä»…è®°å½•ï¼Œmonorepo ä¸åšåˆ é™¤æ“ä½œï¼‰

#### 4.3.1 å·²åºŸå¼ƒçš„ Agent æ¨¡å¼

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | å¤„ç½®ç­–ç•¥ |
|---------|------|----------|
| `backend/agent/streaming_agent.py` | WebSocket æµå¼ Agent | è¿å‡ºåä¿ç•™ï¼Œå¾…æ—§ä»“åº“æ•´ä½“åºŸå¼ƒæ—¶ç»Ÿä¸€å¤„ç† |
| `backend/agent/alert_agent.py` | ç‹¬ç«‹å‘Šè­¦ Agent | è¿å‡ºåä¿ç•™ï¼Œå¾…æ—§ä»“åº“æ•´ä½“åºŸå¼ƒæ—¶ç»Ÿä¸€å¤„ç† |
| `backend/api/http.py` | HTTP æŸ¥è¯¢æ¥å£ | è¿å‡ºåä¿ç•™ï¼Œå¾…æ—§ä»“åº“æ•´ä½“åºŸå¼ƒæ—¶ç»Ÿä¸€å¤„ç† |
| `backend/api/agent_provider.py` | Agent æä¾›è€…æŠ½è±¡å±‚ | ä¿ç•™åœ¨ Backendï¼ˆä¸è¿ç§»ï¼‰ |

#### 4.3.2 æ—§ç‰ˆ MCP ç®¡ç†ä»£ç 

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | å¤„ç½®ç­–ç•¥ |
|---------|------|----------|
| `backend/mcp/dynamic_clients.py` | åŠ¨æ€ MCP å®¢æˆ·ç«¯ç®¡ç†å™¨ | è¿å‡ºåä¿ç•™ï¼Œå¾…æ—§ä»“åº“æ•´ä½“åºŸå¼ƒæ—¶ç»Ÿä¸€å¤„ç† |

---

## 5. è°ƒç”¨é“¾è·¯åˆ†æ

### 5.1 å®Œæ•´è°ƒç”¨é“¾è·¯ï¼ˆæ–°æ¶æ„ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‰ç«¯å‘èµ·æŸ¥è¯¢                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend API (FastAPI)                                         â”‚
â”‚    - POST /api/sse/query/v2                                      â”‚
â”‚    - è°ƒç”¨ agent_provider.query()                                 â”‚
â”‚    - éªŒè¯ç”¨æˆ·æƒé™                                                â”‚
â”‚    - è·å–è´¦å·åˆ—è¡¨                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. AgentCore Client (backend/services/agentcore_client.py)      â”‚
â”‚    - invoke_streaming()                                          â”‚
â”‚    - è°ƒç”¨ AWS Bedrock AgentCore Runtime API                      â”‚
â”‚    - Payload: { prompt, account_id, session_id, ... }           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AgentCore Runtime (AWS Firecracker MicroVM)                  â”‚
â”‚    arn:aws:bedrock-agentcore:...:runtime/...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Agent å…¥å£ (agent_runtime.py)                                â”‚
â”‚    - @app.entrypoint async def invoke(payload)                  â”‚
â”‚    - æ­¥éª¤ 1: è§£æ payload                                        â”‚
â”‚    - æ­¥éª¤ 2: æŸ¥è¯¢ RDS æ•°æ®åº“è·å–è´¦å·ä¿¡æ¯                         â”‚
â”‚    - æ­¥éª¤ 3: AssumeRole / è§£å¯† AKSK / è§£å¯† GCP SA                â”‚
â”‚    - æ­¥éª¤ 4: è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆéš”ç¦»ä¼ é€’ç»™ MCPï¼‰                      â”‚
â”‚    - æ­¥éª¤ 5: åˆ›å»º MCP å®¢æˆ·ç«¯                                     â”‚
â”‚    - æ­¥éª¤ 6: åˆ›å»º Agentï¼ˆBedrockModel + Tools + Memory?ï¼‰       â”‚
â”‚    - æ­¥éª¤ 7: æ‰§è¡Œ Agent.stream_async()                           â”‚
â”‚    - æ­¥éª¤ 8: æµå¼è¿”å›äº‹ä»¶ï¼ˆyield eventsï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”œâ”€â”€â”€> MCP Servers (stdio - æœ¬åœ°)
                    â”‚     - common-tools
                    â”‚     - pricing
                    â”‚     - documentation
                    â”‚     - alert
                    â”‚     - send-email
                    â”‚     - gcp-cost
                    â”‚
                    â””â”€â”€â”€> AgentCore Gateway (HTTP + SigV4)
                          - billing-cost-management
                          - risp
```

### 5.2 å…³é”®æ­¥éª¤è¯¦è§£

#### æ­¥éª¤ 1: Payload è§£æ

**è¾“å…¥**ï¼š
```python
{
    "prompt": "æŸ¥è¯¢æœ¬æœˆæˆæœ¬",
    "account_id": "aws-account-uuid",  # æ•°æ®åº“ä¸­çš„ UUID
    "account_type": "aws",
    "session_id": "sess-12345",
    "user_id": "user-67890",
    "org_id": "org-abcdef",
    "prompt_type": "dialog"  # or "alert"
}
```

**éªŒè¯**ï¼š
- å¿…éœ€å‚æ•°æ£€æŸ¥ï¼š`prompt`, `account_id`
- å¯é€‰å‚æ•°ï¼š`session_id`, `user_id`, `org_id`
- `prompt_type` é»˜è®¤ `"dialog"`

#### æ­¥éª¤ 2: æ•°æ®åº“æŸ¥è¯¢

**SQL æŸ¥è¯¢** (`agent_runtime.py:300-350`):

```sql
-- AWS è´¦å·
SELECT id, account_id, role_arn, org_id, region, auth_type,
       access_key_id, secret_access_key_encrypted
FROM aws_accounts
WHERE id = :account_id  -- UUID
LIMIT 1

-- GCP è´¦å·
SELECT id, project_id, account_name, credentials_encrypted, org_id
FROM gcp_accounts
WHERE id = :account_id  -- UUID
LIMIT 1
```

**è¿”å›**ï¼š
- `account_id` (12ä½æ•°å­—ï¼ŒAWS çœŸå®è´¦å· ID)
- `role_arn` (IAM Role) æˆ– `access_key_id` + `secret_access_key_encrypted` (AKSK)
- `project_id` (GCP é¡¹ç›® ID)

#### æ­¥éª¤ 3: å‡­è¯è·å–

**3.1 IAM Role æ¨¡å¼**ï¼š
```python
from backend.services.iam_role_session_factory import IAMRoleSessionFactory

factory = IAMRoleSessionFactory.get_instance(
    account_id=account_id,
    role_arn=role_arn,
    external_id=f"org-{org_id}",
    region=region
)

credentials = factory.get_current_credentials()
# â†’ { access_key_id, secret_access_key, session_token }
```

**3.2 AKSK æ¨¡å¼**ï¼š
```python
from backend.services.credential_manager import get_credential_manager

manager = get_credential_manager()
secret_key = manager.decrypt_secret_key(encrypted)
# â†’ plain text secret key
```

**3.3 GCP Service Account**ï¼š
```python
from backend.services.gcp_credential_manager import get_gcp_credential_manager

manager = get_gcp_credential_manager()
sa_json = manager.decrypt_credentials(encrypted)
# â†’ service account JSON dict

# å†™å…¥ä¸´æ—¶æ–‡ä»¶
with tempfile.NamedTemporaryFile(mode="w", suffix=".json", delete=False) as f:
    json.dump(sa_json, f)
    service_account_file = f.name
```

#### æ­¥éª¤ 4: ç¯å¢ƒå˜é‡éš”ç¦»

**âœ… å…³é”®è®¾è®¡**ï¼šä½¿ç”¨ `additional_env` å­—å…¸ä¼ é€’å‡­è¯ï¼Œé¿å…æ±¡æŸ“ä¸»è¿›ç¨‹ `os.environ`

```python
additional_env = {}

# AWS å‡­è¯
additional_env["AWS_ACCESS_KEY_ID"] = credentials["access_key_id"]
additional_env["AWS_SECRET_ACCESS_KEY"] = credentials["secret_access_key"]
additional_env["AWS_SESSION_TOKEN"] = credentials.get("session_token", "")
additional_env["AWS_REGION"] = region

# GCP å‡­è¯
additional_env["GOOGLE_APPLICATION_CREDENTIALS"] = service_account_file
additional_env["GCP_PROJECT_ID"] = project_id

# MCP å®¢æˆ·ç«¯åˆ›å»ºæ—¶ä¼ å…¥
mcp_mgr.create_all_clients(
    server_types=available_mcps,
    additional_env=additional_env  # âœ… éš”ç¦»ä¼ é€’
)
```

**ä¸ºä»€ä¹ˆéš”ç¦»ï¼Ÿ**
- ä¸»è¿›ç¨‹ï¼ˆRuntime IAM Roleï¼‰éœ€è¦è®¿é—® OpenTelemetryã€Bedrockã€Memory
- MCP å­è¿›ç¨‹ï¼ˆæŸ¥è¯¢è´¦å·å‡­è¯ï¼‰éœ€è¦è®¿é—® AWS Cost Explorerã€CloudTrail ç­‰
- å¦‚æœæ±¡æŸ“ `os.environ`ï¼ŒOpenTelemetry ä¼šä½¿ç”¨é”™è¯¯çš„å‡­è¯å¯¼è‡´æ—¥å¿—ä¸ŠæŠ¥å¤±è´¥

#### æ­¥éª¤ 5: åˆ›å»º MCP å®¢æˆ·ç«¯

**5.1 æœ¬åœ° MCP (stdio)**ï¼š
```python
from mcp import StdioServerParameters, stdio_client

params = StdioServerParameters(
    command="python",
    args=["-m", f"backend.mcp.{server_type}_mcp_server.server"],
    env={
        **os.environ,  # ç»§æ‰¿ä¸»è¿›ç¨‹ç¯å¢ƒï¼ˆRuntime IAM Roleï¼‰
        **additional_env  # æŸ¥è¯¢è´¦å·å‡­è¯ï¼ˆéš”ç¦»ä¼ é€’ï¼‰
    }
)

client_context = stdio_client(params)
client = client_context.__enter__()
tools = client.list_tools_sync()
```

**5.2 Gateway MCP (HTTP + SigV4)**ï¼š
```python
from backend.services.streamable_http_sigv4 import StreamableHTTPSigV4Transport

transport = StreamableHTTPSigV4Transport(
    base_url=gateway_url,
    service=gateway_service,
    region=aws_region,
    # âœ… è‡ªåŠ¨ä½¿ç”¨å½“å‰è¿›ç¨‹çš„å‡­è¯ï¼ˆRuntime IAM Roleï¼‰
)

client_context = sse_client(transport)
client = client_context.__enter__()
tools = client.list_tools()  # æ”¯æŒåˆ†é¡µ
```

#### æ­¥éª¤ 6: åˆ›å»º Agent

**6.1 å¯¹è¯åœºæ™¯ï¼ˆå¸¦ Memoryï¼‰**ï¼š
```python
from bedrock_agentcore.memory import MemoryClient

memory_client = MemoryClient(region_name=settings.AWS_REGION)
agent = agent_manager.create_agent_with_memory(
    tools=tools,
    memory_client=memory_client,
    memory_id=settings.MEMORY_RESOURCE_ID,
    user_id=user_id,
    session_id=session_id,
    window_size=40
)
```

**6.2 å‘Šè­¦åœºæ™¯ï¼ˆæ—  Memoryï¼‰**ï¼š
```python
alert_agent_manager = AgentManager(
    system_prompt=alert_system_prompt,
    model_id=settings.BEDROCK_MODEL_ID
)
agent = alert_agent_manager.create_agent_with_memory(tools=tools)
```

#### æ­¥éª¤ 7: æ‰§è¡Œ Agent

```python
async for event in agent.stream_async(user_message):
    # è¿‡æ»¤å†—ä½™å­—æ®µï¼ˆé¿å…è§¦å‘ 100MB Runtime é™åˆ¶ï¼‰
    filtered_event = filter_event(event)
    yield filtered_event
```

**äº‹ä»¶ç±»å‹**ï¼š
- `contentBlockStart` â†’ å·¥å…·è°ƒç”¨å¼€å§‹
- `contentBlockDelta` â†’ æ–‡æœ¬æµå¼è¾“å‡º
- `toolResult` â†’ å·¥å…·æ‰§è¡Œç»“æœ
- `result` â†’ æœ€ç»ˆç»“æœï¼ˆå« Token ç»Ÿè®¡ï¼‰

---

## 6. ä¾èµ–å…³ç³»åˆ†æ

### 6.1 Agent ä¾èµ–çš„å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | ç”¨é€” | é…ç½®æ¥æº | å‡­è¯æ–¹å¼ |
|------|------|----------|----------|
| **RDS PostgreSQL** | æŸ¥è¯¢è´¦å·ä¿¡æ¯ | `RDS_SECRET_NAME` | Runtime IAM Role â†’ Secrets Manager |
| **AWS Bedrock** | LLM æ¨ç† | `BEDROCK_MODEL_ID` | Runtime IAM Role (+ è·¨è´¦å· AssumeRole) |
| **AgentCore Memory** | é•¿æœŸè®°å¿† | `MEMORY_RESOURCE_ID` | Runtime IAM Role |
| **AWS Cost Explorer** | æˆæœ¬æŸ¥è¯¢ï¼ˆé€šè¿‡ MCPï¼‰ | æŸ¥è¯¢è´¦å· | AssumeRole / AKSK |
| **AWS CloudTrail** | æ—¥å¿—æŸ¥è¯¢ï¼ˆé€šè¿‡ Gatewayï¼‰ | æŸ¥è¯¢è´¦å· | AssumeRole / AKSK |
| **GCP BigQuery** | GCP æˆæœ¬æŸ¥è¯¢ï¼ˆé€šè¿‡ MCPï¼‰ | æŸ¥è¯¢è´¦å· | Service Account JSON |

### 6.2 Agent ä¾èµ–çš„å†…éƒ¨æ¨¡å—

```
agent_runtime.py
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py (å¿…éœ€)
â”‚   â””â”€â”€ aws_secrets.py (å¿…éœ€)
â”œâ”€â”€ database.py (å¿…éœ€)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ aws_account.py (å¿…éœ€)
â”‚   â””â”€â”€ gcp_account.py (å¿…éœ€)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ credential_manager.py (å¿…éœ€)
â”‚   â”œâ”€â”€ gcp_credential_manager.py (å¿…éœ€)
â”‚   â”œâ”€â”€ iam_role_session_factory.py (å¿…éœ€)
â”‚   â””â”€â”€ streamable_http_sigv4.py (å¿…éœ€ - Gateway MCP è®¤è¯)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ aws_session_factory.py (å¿…éœ€ - Bedrock è·¨è´¦å·)
â”‚   â””â”€â”€ env_isolation_validator.py (å¿…éœ€ - ç¯å¢ƒå˜é‡éš”ç¦»éªŒè¯)
â””â”€â”€ mcp/
    â”œâ”€â”€ mcp_manager.py (å¿…éœ€)
    â”œâ”€â”€ connection_pool.py (å¿…éœ€)
    â”œâ”€â”€ common_tools_mcp_server/ (å¿…éœ€)
    â”œâ”€â”€ alert_mcp_server/ (å¿…éœ€)
    â”œâ”€â”€ send_email_mcp_server/ (å¿…éœ€)
    â””â”€â”€ gcp_cost_mcp_server/ (å¿…éœ€)
```

### 6.3 Backend ä¾èµ–çš„ Agent æ¨¡å—

```
backend/api/agent_provider.py
â”œâ”€â”€ services/agentcore_client.py
â”‚   â””â”€â”€ è°ƒç”¨ AgentCore Runtime (invoke_streaming)
â””â”€â”€ api/agentcore_response_parser.py
    â””â”€â”€ è§£æ Runtime è¿”å›çš„ SSE äº‹ä»¶
```

**å…³é”®ç‚¹**ï¼š
- Backend **ä¸ç›´æ¥ä¾èµ–** Agent ä»£ç 
- é€šè¿‡ **AgentCore Runtime API** è°ƒç”¨ Agent
- Agent è¿ç§»åï¼ŒBackend ä»…éœ€æ›´æ–° `AGENTCORE_RUNTIME_ARN` é…ç½®

---

## 7. è¿ç§»è®¡åˆ’

### 7.1 æ–°ä»“åº“ç›®å½•ç»“æ„è®¾è®¡

```
costq-agents/  (æ–°ä»“åº“)
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ runtime.py  (åŸ agent_runtime.py)
â”‚   â”œâ”€â”€ manager.py  (åŸ agent_manager.py)
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ loader.py
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ core/
â”‚       â”œâ”€â”€ aws/
â”‚       â”œâ”€â”€ gcp/
â”‚       â”œâ”€â”€ shared/
â”‚       â”œâ”€â”€ examples/
â”‚       â””â”€â”€ alert_agent/
â”‚           â”œâ”€â”€ alert_prompts.py
â”‚           â””â”€â”€ alert_execution_system.md
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py  (å¤åˆ¶ + ç²¾ç®€)
â”‚   â””â”€â”€ aws_secrets.py
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ aws_account.py
â”‚       â””â”€â”€ gcp_account.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ credential_manager.py
â”‚   â”œâ”€â”€ gcp_credential_manager.py
â”‚   â”œâ”€â”€ iam_role_session_factory.py
â”‚   â””â”€â”€ streamable_http_sigv4.py
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ aws_session_factory.py
â”‚   â””â”€â”€ env_isolation_validator.py
â”œâ”€â”€ mcp/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ manager.py  (åŸ mcp_manager.py)
â”‚   â”œâ”€â”€ connection_pool.py
â”‚   â”œâ”€â”€ common_tools/  (åŸ common_tools_mcp_server/)
â”‚   â”œâ”€â”€ alert/  (åŸ alert_mcp_server/)
â”‚   â”œâ”€â”€ send_email/  (åŸ send_email_mcp_server/)
â”‚   â””â”€â”€ gcp_cost/  (åŸ gcp_cost_mcp_server/)
â”œâ”€â”€ config_runtime/
â”‚   â””â”€â”€ mcp_config.json  (è¿ç§»è‡ª monorepo æ ¹ç›®å½• config/mcp_config.json)
â””â”€â”€ tests/
    â”œâ”€â”€ test_runtime.py
    â”œâ”€â”€ test_manager.py
    â””â”€â”€ test_mcp_manager.py
```

### 7.2 è¿ç§»æ­¥éª¤

#### Phase 1: å‡†å¤‡å·¥ä½œ

- [ ] åˆ›å»ºæ–°ä»“åº“ `costq-agents`
- [ ] åˆå§‹åŒ–åŸºç¡€ç»“æ„ï¼ˆREADME, .gitignore, requirements.txtï¼‰
- [ ] è®¾ç½® CI/CD æµç¨‹ï¼ˆGitHub Actionsï¼‰

#### Phase 2: ä»£ç è¿ç§»

**2.1 æ ¸å¿ƒ Agent ä»£ç **
- [ ] å¤åˆ¶ `agent_runtime.py` â†’ `agent/runtime.py`
- [ ] å¤åˆ¶ `agent_manager.py` â†’ `agent/manager.py`
- [ ] å¤åˆ¶ `prompts/` â†’ `agent/prompts/`ï¼ˆä¿ç•™æ¨¡å—åŒ–ç›®å½•ä¸ loaderï¼‰
- [ ] æ—§ä»“åº“ä¸åšåˆ é™¤æ“ä½œï¼ˆstreaming_agent.py / alert_agent.py ä¿ç•™ï¼Œå¾…æ•´ä½“åºŸå¼ƒæ—¶å¤„ç†ï¼‰

**2.2 é…ç½®æ¨¡å—**
- [ ] å¤åˆ¶ `config/settings.py` â†’ `config/settings.py`
- [ ] ç²¾ç®€é…ç½®ï¼ˆåˆ é™¤ Frontendã€Backend ä¸“ç”¨é…ç½®ï¼‰
- [ ] ä¿ç•™ï¼šAWSã€Bedrockã€Memoryã€MCP é…ç½®
- [ ] å¤åˆ¶ `config/aws_secrets.py`

**2.3 æ•°æ®åº“æ¨¡å—**
- [ ] å¤åˆ¶ `database.py` â†’ `database/connection.py`
- [ ] ç²¾ç®€æ¨¡å‹å®šä¹‰ï¼ˆä»…ä¿ç•™è´¦å·æ¨¡å‹ï¼‰
- [ ] å¤åˆ¶ `models/aws_account.py`
- [ ] å¤åˆ¶ `models/gcp_account.py`

**2.4 æœåŠ¡å±‚**
- [ ] å¤åˆ¶ `services/credential_manager.py`
- [ ] å¤åˆ¶ `services/gcp_credential_manager.py`
- [ ] å¤åˆ¶ `services/iam_role_session_factory.py`
- [ ] å¤åˆ¶ `services/streamable_http_sigv4.py`
- [ ] å¤åˆ¶ `utils/aws_session_factory.py`
- [ ] å¤åˆ¶ `utils/env_isolation_validator.py`

**2.5 MCP æ¨¡å—**
- [ ] å¤åˆ¶ `mcp/mcp_manager.py` â†’ `mcp/manager.py`
- [ ] å¤åˆ¶ `mcp/connection_pool.py`
- [ ] å¤åˆ¶æœ¬åœ° MCP Serverï¼š
  - [ ] `common_tools_mcp_server/` â†’ `mcp/common_tools/`
  - [ ] `alert_mcp_server/` â†’ `mcp/alert/`
  - [ ] `send_email_mcp_server/` â†’ `mcp/send_email/`
  - [ ] `gcp_cost_mcp_server/` â†’ `mcp/gcp_cost/`

#### Phase 3: ä»£ç æ¸…ç†å’Œä¼˜åŒ–ï¼ˆä»…æ–°ä»“åº“ï¼‰

**3.1 ç®€åŒ–å¯¼å…¥è·¯å¾„**
- [ ] æ›´æ–°æ‰€æœ‰ `from backend.xxx` â†’ `from xxx`
- [ ] æ›´æ–°é…ç½®å¼•ç”¨ï¼š`backend.config.settings` â†’ `config.settings`

**3.2 åˆ é™¤å†—ä½™ä»£ç ï¼ˆæ–°ä»“åº“å†…ï¼‰**
- [ ] åˆ é™¤ Backend ä¸“ç”¨é…ç½®ï¼ˆCORSã€JWT ç­‰ï¼‰
- [ ] åˆ é™¤æœªä½¿ç”¨çš„æ•°æ®åº“æ¨¡å‹ï¼ˆUser, ChatSession ç­‰ï¼‰
- [ ] åˆ é™¤å®¡è®¡æ—¥å¿—ã€èŠå¤©è®°å½•å­˜å‚¨ç­‰ Backend åŠŸèƒ½

**3.3 ä¼˜åŒ–ä¾èµ–**
- [ ] ç²¾ç®€ `requirements.txt`ï¼ˆåˆ é™¤ FastAPIã€å‰ç«¯ç›¸å…³ä¾èµ–ï¼‰
- [ ] ä¿ç•™æ ¸å¿ƒä¾èµ–ï¼š
  - `strands-agents`
  - `bedrock-agentcore`
  - `boto3`
  - `mcp`
  - `sqlalchemy`
  - `psycopg2-binary`

#### Phase 4: æµ‹è¯•éªŒè¯

**4.1 å•å…ƒæµ‹è¯•**
- [ ] æµ‹è¯• AgentManager åˆ›å»º Agent
- [ ] æµ‹è¯• MCPManager åˆ›å»ºå®¢æˆ·ç«¯
- [ ] æµ‹è¯•å‡­è¯ç®¡ç†å™¨
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥

**4.2 é›†æˆæµ‹è¯•**
- [ ] æœ¬åœ°æµ‹è¯• Runtime å…¥å£ï¼ˆ`python agent/runtime.py`ï¼‰
- [ ] æ¨¡æ‹Ÿ AgentCore è°ƒç”¨ï¼ˆPOST `/invocations`ï¼‰
- [ ] éªŒè¯ MCP å·¥å…·æ­£å¸¸åŠ è½½
- [ ] éªŒè¯ Agent æ­£å¸¸æ‰§è¡Œ

**4.3 éƒ¨ç½²æµ‹è¯•**
- [ ] æ„å»º Docker é•œåƒ
- [ ] éƒ¨ç½²åˆ° AgentCore Runtime (Dev)
- [ ] é€šè¿‡ Backend API è°ƒç”¨ Agent
- [ ] éªŒè¯ç«¯åˆ°ç«¯æµç¨‹

#### Phase 5: ç”Ÿäº§éƒ¨ç½²

**5.1 æ›´æ–° Backend é…ç½®**
- [ ] æ›´æ–° `AGENTCORE_RUNTIME_ARN` æŒ‡å‘æ–° Runtime

**5.2 éƒ¨ç½²æ–° Agent**
- [ ] éƒ¨ç½²åˆ° AgentCore Runtime (Prod)
- [ ] é‡‘ä¸é›€å‘å¸ƒï¼ˆ10% æµé‡ï¼‰
- [ ] ç›‘æ§é”™è¯¯ç‡å’Œæ€§èƒ½
- [ ] å…¨é‡å‘å¸ƒï¼ˆ100% æµé‡ï¼‰

**5.3 æ—§ä»“åº“å¤„ç†ç­–ç•¥**
- [ ] åŸ monorepo ä¸åšä»£ç åˆ é™¤æ“ä½œï¼Œä¿æŒç°çŠ¶
- [ ] æ–°ä»“åº“ç¨³å®šåï¼Œæ—§ä»“åº“æ•´ä½“æ ‡è®°ä¸ºåºŸå¼ƒå¹¶åœæ­¢æ¼”è¿›
- [ ] README ä»…æ›´æ–°ä¸ºâ€œè¿ç§»æŒ‡å¼•/åºŸå¼ƒè¯´æ˜â€ï¼ˆå¦‚éœ€ï¼‰

### 7.3 éªŒè¯æ¸…å•

#### åŠŸèƒ½éªŒè¯

- [ ] Agent å¯æ­£å¸¸å¯åŠ¨
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å‡­è¯åŠ å¯†/è§£å¯†æ­£å¸¸
- [ ] IAM Role AssumeRole æ­£å¸¸
- [ ] MCP å®¢æˆ·ç«¯åˆ›å»ºæ­£å¸¸
  - [ ] æœ¬åœ° MCP (stdio)
  - [ ] Gateway MCP (HTTP + SigV4)
- [ ] Agent æ‰§è¡Œæ­£å¸¸
  - [ ] å¯¹è¯åœºæ™¯ï¼ˆå¸¦ Memoryï¼‰
  - [ ] å‘Šè­¦åœºæ™¯ï¼ˆæ—  Memoryï¼‰
- [ ] å·¥å…·è°ƒç”¨æ­£å¸¸
  - [ ] AWS Cost Explorer
  - [ ] GCP BigQuery
  - [ ] é‚®ä»¶å‘é€
  - [ ] å‘Šè­¦ç®¡ç†
- [ ] æµå¼è¾“å‡ºæ­£å¸¸
- [ ] Token ç»Ÿè®¡æ­£å¸¸

#### æ€§èƒ½éªŒè¯

- [ ] å†·å¯åŠ¨æ—¶é—´ < 10 ç§’
- [ ] é¦–ä¸ªå·¥å…·è°ƒç”¨å“åº” < 5 ç§’
- [ ] Memory æ£€ç´¢å»¶è¿Ÿ < 2 ç§’
- [ ] Gateway MCP å“åº” < 3 ç§’

#### å®‰å…¨éªŒè¯

- [ ] ç¯å¢ƒå˜é‡éš”ç¦»æ­£å¸¸ï¼ˆRuntime IAM Role æœªè¢«æ±¡æŸ“ï¼‰
- [ ] å‡­è¯åŠ å¯†å¼ºåº¦ç¬¦åˆè¦æ±‚ï¼ˆFernetï¼‰
- [ ] æ•°æ®åº“å¯†ç ä» Secrets Manager è¯»å–
- [ ] æ— æ˜æ–‡å‡­è¯æ³„æ¼åˆ°æ—¥å¿—

---

## 8. é£é™©è¯„ä¼°

### 8.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| **æ•°æ®åº“è¿æ¥å¤±è´¥** | é«˜ | ä½ | - ä¿æŒæ•°æ®åº“æ¨¡å—å®Œå…¨ä¸€è‡´<br>- ä½¿ç”¨ç›¸åŒçš„ Secrets Manager è¯»å–æ–¹å¼<br>- æå‰åœ¨ Dev ç¯å¢ƒæµ‹è¯• |
| **å‡­è¯è§£å¯†å¤±è´¥** | é«˜ | ä½ | - ç¡®ä¿ `ENCRYPTION_KEY` ç¯å¢ƒå˜é‡æ­£ç¡®ä¼ é€’<br>- ä¿æŒ `credential_manager` å®Œå…¨ä¸€è‡´ |
| **MCP å·¥å…·åŠ è½½å¤±è´¥** | ä¸­ | ä¸­ | - ä¿æŒ MCP Server ä»£ç å®Œå…¨ä¸€è‡´<br>- éªŒè¯ç¯å¢ƒå˜é‡ä¼ é€’æ­£ç¡®<br>- æµ‹è¯•æœ¬åœ°å’Œ Gateway MCP |
| **Memory åˆå§‹åŒ–å¤±è´¥** | ä¸­ | ä¸­ | - å·²æœ‰å¼‚å¸¸å¤„ç†ï¼ˆå›é€€åˆ°æ—  Memory æ¨¡å¼ï¼‰<br>- ç¡®ä¿ `MEMORY_RESOURCE_ID` æ­£ç¡®<br>- éªŒè¯ IAM Role æƒé™ |
| **Bedrock è·¨è´¦å·å¤±è´¥** | ä¸­ | ä½ | - å·²æœ‰å¼‚å¸¸å¤„ç†å’Œè¯¦ç»†æ—¥å¿—<br>- éªŒè¯ AssumeRole é“¾è·¯<br>- æµ‹è¯• `AWSSessionFactory` |
| **Runtime 100MB é™åˆ¶** | ä½ | ä½ | - å·²å®ç°äº‹ä»¶è¿‡æ»¤ï¼ˆ`filter_event`ï¼‰<br>- äº‹ä»¶å¤§å°ä» 100KB é™åˆ° 500B |

### 8.2 ä¸šåŠ¡é£é™©

| é£é™©é¡¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| **åŠŸèƒ½ç¼ºå¤±** | é«˜ | ä½ | - å®Œæ•´çš„åŠŸèƒ½æ¸…å•å’ŒéªŒè¯<br>- å¯¹æ¯”æ–°æ—§æ¶æ„çš„å·¥å…·åˆ—è¡¨<br>- ä¿ç•™æ—§ä»£ç ä½œä¸ºå¤‡ä»½ |
| **æ€§èƒ½ä¸‹é™** | ä¸­ | ä½ | - æ€§èƒ½åŸºå‡†æµ‹è¯•<br>- ç›‘æ§å†·å¯åŠ¨æ—¶é—´<br>- ä¼˜åŒ– MCP è¿æ¥å¤ç”¨ |
| **ç”¨æˆ·ä½“éªŒå½±å“** | ä¸­ | ä½ | - ç°åº¦å‘å¸ƒï¼ˆ10% â†’ 100%ï¼‰<br>- å®æ—¶ç›‘æ§é”™è¯¯ç‡<br>- å¿«é€Ÿå›æ»šæœºåˆ¶ |

### 8.3 è¿ç»´é£é™©

| é£é™©é¡¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| **éƒ¨ç½²å¤±è´¥** | é«˜ | ä½ | - CI/CD è‡ªåŠ¨åŒ–æµ‹è¯•<br>- åˆ†é˜¶æ®µéƒ¨ç½²ï¼ˆDev â†’ Prodï¼‰<br>- è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£ |
| **é…ç½®é”™è¯¯** | ä¸­ | ä¸­ | - é…ç½®æ¸…å•å’ŒéªŒè¯è„šæœ¬<br>- ç¯å¢ƒå˜é‡éªŒè¯å·¥å…·<br>- éƒ¨ç½²å‰æ£€æŸ¥æ¸…å• |
| **ç›‘æ§ç›²åŒº** | ä¸­ | ä¸­ | - ä¿ç•™ OpenTelemetry æ—¥å¿—<br>- æ·»åŠ  CloudWatch Metrics<br>- è®¾ç½®å‘Šè­¦è§„åˆ™ |

### 8.4 å›æ»šè®¡åˆ’

å¦‚æœæ–° Agent å‡ºç°ä¸¥é‡é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

1. **Backend é…ç½®å›æ»š**
   - å°† `AGENTCORE_RUNTIME_ARN` æ”¹å›æ—§ Runtime
   - é‡å¯ Backend Pod

2. **Runtime å›æ»š**
   - é‡æ–°éƒ¨ç½²æ—§ç‰ˆ Runtime é•œåƒ
   - éªŒè¯åŠŸèƒ½æ­£å¸¸

3. **æ•°æ®åº“å›æ»š**
   - ä¸æ¶‰åŠæ•°æ®åº“ Schema å˜æ›´ï¼Œæ— éœ€å›æ»š

4. **æ—¶é—´çª—å£**
   - å‡†å¤‡ï¼š2 å°æ—¶
   - æ‰§è¡Œï¼š30 åˆ†é’Ÿ
   - éªŒè¯ï¼š1 å°æ—¶

---

## 9. åç»­ä¼˜åŒ–å»ºè®®

### 9.1 ä»£ç ä¼˜åŒ–

- [ ] è¿›ä¸€æ­¥æ‹†åˆ† `runtime.py`ï¼ˆå½“å‰ 1000+ è¡Œï¼Œå¯æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼‰
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—æ ¼å¼
- [ ] å¢åŠ ç±»å‹æ³¨è§£è¦†ç›–ç‡
- [ ] ç¼–å†™å®Œå–„çš„å•å…ƒæµ‹è¯•

### 9.2 æ€§èƒ½ä¼˜åŒ–

- [ ] MCP è¿æ¥æ± é¢„çƒ­
- [ ] Bedrock Model è¿æ¥å¤ç”¨
- [ ] Memory æ£€ç´¢ç¼“å­˜
- [ ] Gateway MCP å“åº”ç¼“å­˜

### 9.3 ç›‘æ§å¢å¼º

- [ ] æ·»åŠ è‡ªå®šä¹‰ Metricsï¼ˆå·¥å…·è°ƒç”¨æ¬¡æ•°ã€å»¶è¿Ÿï¼‰
- [ ] æ·»åŠ æˆæœ¬è¿½è¸ªï¼ˆBedrock Token ä½¿ç”¨ï¼‰
- [ ] æ·»åŠ å‘Šè­¦è§„åˆ™ï¼ˆé”™è¯¯ç‡ã€å»¶è¿Ÿï¼‰

---

## 10. æ€»ç»“

### 10.1 æ ¸å¿ƒè¦ç‚¹

âœ… **ä»£ç ä»“åº“æ‹†åˆ†**
- ä»å•ä½“ä»“åº“ä¸­å‰¥ç¦» Agent ä»£ç 
- åˆ›å»ºç‹¬ç«‹çš„ Git ä»“åº“ `costq-agents`
- ä»£ç ç®¡ç†ä¸éƒ¨ç½²æ¶æ„å¯¹é½

âœ… **éƒ¨ç½²ä¿æŒä¸å˜**
- Agent å·²ç»ç‹¬ç«‹éƒ¨ç½²åœ¨ AgentCore Runtimeï¼ˆæ— éœ€æ”¹åŠ¨ï¼‰
- æœ¬æ¬¡é‡æ„ä»…æ¶‰åŠä»£ç ä»“åº“æ‹†åˆ†
- ä¸å½±å“ç°æœ‰çš„è¿è¡Œæ¶æ„

âœ… **ç®¡ç†æ›´æ¸…æ™°**
- Backend: API è·¯ç”±ã€æƒé™éªŒè¯ã€èŠå¤©è®°å½•å­˜å‚¨
- Agent: LLM æ¨ç†ã€å·¥å…·è°ƒç”¨ã€é•¿æœŸè®°å¿†
- ç‹¬ç«‹çš„ä»£ç å®¡æŸ¥å’Œç‰ˆæœ¬æ§åˆ¶

### 10.2 å…³é”®æ”¶ç›Š

1. **ä»£ç ç®¡ç†æ¸…æ™°** - Agent ä¸ Backend ä»£ç å®Œå…¨åˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
2. **ç‰ˆæœ¬æ§åˆ¶ç‹¬ç«‹** - Agent å¯ç‹¬ç«‹å‘å¸ƒç‰ˆæœ¬ï¼Œä¸å— Backend å½±å“
3. **ä»£ç å®¡æŸ¥ç®€åŒ–** - Agent å’Œ Backend å„è‡ªç‹¬ç«‹å®¡æŸ¥ï¼Œå‡å°‘å¹²æ‰°
4. **æ¶æ„ä¸€è‡´æ€§** - ä»£ç ä»“åº“ç»“æ„ä¸éƒ¨ç½²æ¶æ„å¯¹é½
5. **å¯æ‰©å±•æ€§** - ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½ï¼ˆå¤š Agentã€ç¼–æ’ç­‰ï¼‰

### 10.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. ç¡®è®¤éœ€æ±‚æ–‡æ¡£æ— è¯¯
2. åˆ›å»ºæ–°ä»“åº“ `costq-agents`
3. æŒ‰ç…§è¿ç§»è®¡åˆ’æ‰§è¡Œ
4. Dev ç¯å¢ƒæµ‹è¯•
5. Prod ç¯å¢ƒç°åº¦å‘å¸ƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-23
**ä½œè€…**: AI Assistant
**çŠ¶æ€**: å¾…ç¡®è®¤
